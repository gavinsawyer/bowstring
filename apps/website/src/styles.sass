@use 'sass:math'
@import 'normalize.css'


$primary:          hsl(129, 16%, 55%)
$primary-contrast: hsl(129, 8%, 96%)

$body-shade: 15%
$footer-shade: 25%
$card-shade: 20%

$border-radius: 1rem

$grey-factor:       40%
$dark-theme-factor: 80%

$depth-blur:   0.5rem

$body-background-shade:   100% - ($body-shade - 15)
$footer-background-shade: 100% - ($footer-shade - 15)
$card-background-shade:   100% - ($card-shade - 15)

$body-light-foreground:      hsl(0, 0%, $body-shade)
$body-light-background:      hsl(0, 0%, $body-background-shade)
$body-light-foreground-grey: lighten($body-light-foreground, $grey-factor)
$body-light-background-grey: lighten($body-light-background, $grey-factor)

$body-dark-foreground:      lighten($body-light-foreground, $dark-theme-factor)
$body-dark-background:      darken($body-light-background, $dark-theme-factor)
$body-dark-foreground-grey: darken($body-dark-foreground, $grey-factor)
$body-dark-background-grey: darken($body-dark-background, $grey-factor)

$footer-light-foreground:      hsl(0, 0%, $footer-shade)
$footer-light-background:      hsl(0, 0%, $footer-background-shade)
$footer-light-foreground-grey: lighten($footer-light-foreground, $grey-factor)
$footer-light-background-grey: lighten($footer-light-background, $grey-factor)

$footer-dark-foreground:      lighten($footer-light-foreground, $dark-theme-factor)
$footer-dark-background:      darken($footer-light-background, $dark-theme-factor)
$footer-dark-foreground-grey: darken($footer-dark-foreground, $grey-factor)
$footer-dark-background-grey: darken($footer-dark-background, $grey-factor)

$card-light-foreground:      hsl(0, 0%, $card-shade)
$card-light-background:      hsl(0, 0%, $card-background-shade)
$card-light-foreground-grey: lighten($card-light-foreground, $grey-factor)
$card-light-background-grey: lighten($card-light-background, $grey-factor)

$card-dark-foreground:      lighten($card-light-foreground, $dark-theme-factor)
$card-dark-background:      darken($card-light-background, $dark-theme-factor)
$card-dark-foreground-grey: darken($card-dark-foreground, $grey-factor)
$card-dark-background-grey: darken($card-dark-background, $grey-factor)

$glass-light:          transparentize($body-light-background, math.div(1, 5))
$glass-light-backdrop: transparentize(darken($body-light-background, 35%), math.div(3, 4))

$glass-dark:          transparentize($body-dark-background, math.div(1, 5))
$glass-dark-backdrop: transparentize(lighten($body-dark-background, 20%), math.div(3, 4))

$depth-offset: $depth-blur * 0.5
$depth-spread: $depth-offset * -1.03125

html,
body
  font-size: 16px

body
  --primary:          #{ $primary }
  --primary-contrast: #{ $primary-contrast }

  --depth-blur:   #{ $depth-blur }

  --border-radius: #{ $border-radius }

  --body-light-foreground:      #{ $body-light-foreground }
  --body-light-background:      #{ $body-light-background }
  --body-light-foreground-grey: #{ $body-light-foreground-grey }
  --body-light-background-grey: #{ $body-light-background-grey }

  --body-dark-foreground:      #{ $body-dark-foreground }
  --body-dark-background:      #{ $body-dark-background }
  --body-dark-foreground-grey: #{ $body-dark-foreground-grey }
  --body-dark-background-grey: #{ $body-dark-background-grey }

  --footer-light-foreground:      #{ $footer-light-foreground }
  --footer-light-background:      #{ $footer-light-background }
  --footer-light-foreground-grey: #{ $footer-light-foreground-grey }
  --footer-light-background-grey: #{ $footer-light-background-grey }

  --footer-dark-foreground:      #{ $footer-dark-foreground }
  --footer-dark-background:      #{ $footer-dark-background }
  --footer-dark-foreground-grey: #{ $footer-dark-foreground-grey }
  --footer-dark-background-grey: #{ $footer-dark-background-grey }

  --card-light-foreground:      #{ $card-light-foreground }
  --card-light-background:      #{ $card-light-background }
  --card-light-foreground-grey: #{ $card-light-foreground-grey }
  --card-light-background-grey: #{ $card-light-background-grey }

  --card-dark-foreground:      #{ $card-dark-foreground }
  --card-dark-background:      #{ $card-dark-background }
  --card-dark-foreground-grey: #{ $card-dark-foreground-grey }
  --card-dark-background-grey: #{ $card-dark-background-grey }

  --glass-light:          #{ $glass-light }
  --glass-light-backdrop: #{ $glass-light-backdrop }

  --glass-dark:          #{ $glass-dark }
  --glass-dark-backdrop: #{ $glass-dark-backdrop }

  --depth-offset: #{ $depth-offset }
  --depth-spread: #{ $depth-spread }

  display: flex
  flex-direction: row
  font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Helvetica Neue, sans-serif
  justify-content: center

  a
    position: relative
    color: var(--primary)
    text-decoration: none
    transition: color 200ms ease
    z-index: 0

    &::before
      bottom: 0.03em
      content: ""
      display: block
      height: 0.06em
      right: 0
      position: absolute
      transition: background 200ms ease, width 200ms ease
      width: 0
      z-index: -1

    &:hover,
    &:focus-visible
      outline: none

      &::before
        left: 0
        width: 100%

    &.no-op
      cursor: default

      &::before
        left: 0
        width: 100%

  article,
  section
    display: flex
    flex-direction: column
    gap: 1rem

  hgroup
    max-width: 30rem

    & > h1,
    & > h2
      margin: 0 0 0.875rem

      &:has(+ p > span.caption:first-child)
        margin-bottom: 1.125rem

    & > p
      font-size: 1.125rem
      margin: 0.875rem 0 0

      & > span.caption
        align-items: first baseline
        display: inline-flex
        flex-direction: row
        flex-wrap: wrap
        font-size: 1rem
        font-variant: all-small-caps
        gap: 0.875rem
        margin-bottom: 0.875rem

      & > span.content
        display: inline-block

        &::first-letter
          float: left
          font-size: 2.75rem
          font-weight: 200
          line-height: 0.9em
          margin-right: .05em
          vertical-align: top

  @mixin colors($body-foreground, $body-foreground-gray, $body-background)
    background: $body-background
    color: $body-foreground

    a
      text-shadow: $body-background 0.07em 0.07em, $body-background 0 0.07em, $body-background -0.07em 0.07em, $body-background -0.07em 0, $body-background -0.07em -0.07em, $body-background 0 -0.07em, $body-background 0.07em -0.07em, $body-background 0.07em 0

      &::before
        background: $body-foreground

      &:active,
      &.no-op
        color: $body-foreground-gray

        &::before
          background: $body-foreground-gray

  @include colors(var(--body-light-foreground), var(--body-light-foreground-grey), var(--body-light-background))

  @media (prefers-color-scheme: dark)
    @include colors(var(--body-dark-foreground), var(--body-dark-foreground-grey), var(--body-dark-background))
