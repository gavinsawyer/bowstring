{
  "$schema":     "../../node_modules/nx/schemas/project-schema.json",
  "i18n":        {
    "locales":      {
      "fr-FR": {
        "baseHref":    "/fr-FR/",
        "translation": "apps/website/src/locales/messages.fr-FR.json"
      }
    },
    "sourceLocale": "en-US"
  },
  "name":        "website",
  "prefix":      "standard-website",
  "projectType": "application",
  "sourceRoot":  "apps/website/src",
  "targets":     {
    "angular-browser":         {
      "configurations":       {
        "development": {
          "localize": [
            "en-US"
          ]
        },
        "production":  {
          "budgets":          [
            {
              "maximumError":   "1.5mb",
              "maximumWarning": "750kb",
              "type":           "initial"
            },
            {
              "maximumError":   "10kb",
              "maximumWarning": "5kb",
              "type":           "anyComponentStyle"
            }
          ],
          "fileReplacements": [
            {
              "replace": "apps/website/src/environment.ts",
              "with":    "apps/website/src/environment.prod.ts"
            }
          ],
          "localize":         true
        }
      },
      "defaultConfiguration": "production",
      "dependsOn":            [
        "eslint"
      ],
      "executor":             "@angular-devkit/build-angular:browser",
      "options":              {
        "allowedCommonJsDependencies": [
          "url",
          "xhr2"
        ],
        "assets":                      [
          "apps/website/src/assets",
          "apps/website/src/robots.txt",
          "apps/website/src/sitemap.xml"
        ],
        "deleteOutputPath":            false,
        "index":                       "apps/website/src/index.html",
        "inlineStyleLanguage":         "sass",
        "main":                        "apps/website/src/app/main.browser.ts",
        "outputHashing":               "all",
        "outputPath":                  "dist/apps/website/browser",
        "polyfills":                   "apps/website/src/polyfills.ts",
        "styles":                      [
          "apps/website/src/styles.sass"
        ],
        "tsConfig":                    "apps/website/tsconfig.app.json"
      },
      "outputs":              [
        "{workspaceRoot}/{options.outputPath}"
      ]
    },
    "angular-extract-i18n":    {
      "dependsOn": [
        "eslint"
      ],
      "executor":  "@nx/angular:extract-i18n",
      "options":   {
        "buildTarget": "website:angular-browser:production",
        "format":      "json",
        "outFile":     "messages.en-US.json",
        "outputPath":  "apps/website/src/locales",
        "progress":    true
      }
    },
    "angular-firebase-deploy": {
      "dependsOn": [
        "build"
      ],
      "executor":  "@angular/fire:deploy",
      "options":   {
        "browserTarget":        "website:angular-browser:production",
        "firebaseHostingSite":  "standard-3eac7",
        "firebaseProject":      "standard-3eac7",
        "functionName":         "ssr-website",
        "functionsNodeVersion": "20.11",
        "outputPath":           "dist/apps/website/run",
        "prerender":            true,
        "prerenderTarget":      "website:angular-prerender:production",
        "region":               "us-central1",
        "serverTarget":         "website:angular-server:production",
        "ssr":                  "cloud-run"
      }
    },
    "angular-prerender":       {
      "configurations":       {
        "development": {
          "browserTarget": "website:angular-browser:development",
          "serverTarget":  "website:angular-server:development"
        },
        "production":  {
          "browserTarget": "website:angular-browser:production",
          "serverTarget":  "website:angular-server:production"
        }
      },
      "defaultConfiguration": "production",
      "dependsOn":            [
        "angular-server"
      ],
      "executor":             "@angular-devkit/build-angular:prerender",
      "options":              {
        "routes": [
          "/",
          "/privacy",
          "/terms"
        ]
      },
      "outputs":              [
        "{workspaceRoot}/dist/apps/website/browser"
      ]
    },
    "angular-server":          {
      "configurations":       {
        "development": {
          "outputHashing": "none"
        },
        "production":  {
          "fileReplacements": [
            {
              "replace": "apps/website/src/environment.ts",
              "with":    "apps/website/src/environment.prod.ts"
            }
          ],
          "localize":         true,
          "outputHashing":    "all"
        }
      },
      "defaultConfiguration": "production",
      "dependsOn":            [
        "eslint"
      ],
      "executor":             "@angular-devkit/build-angular:server",
      "options":              {
        "deleteOutputPath":    false,
        "inlineStyleLanguage": "sass",
        "main":                "apps/website/src/app/main.server.ts",
        "outputPath":          "dist/apps/website/server",
        "tsConfig":            "apps/website/tsconfig.app.json"
      },
      "outputs":              [
        "{workspaceRoot}/{options.outputPath}"
      ]
    },
    "angular-ssr-dev-server":  {
      "dependsOn": [
        "eslint"
      ],
      "executor":  "@angular-devkit/build-angular:ssr-dev-server",
      "options":   {
        "browserTarget": "website:angular-browser:development",
        "serverTarget":  "website:angular-server:development"
      }
    },
    "build":                   {
      "dependsOn": [
        "esbuild-intl-server"
      ],
      "executor":  "nx:run-commands",
      "options":   {
        "commands": [
          "mv dist/apps/website/server/main.intl-server.cjs dist/apps/website/server/main.js"
        ]
      },
      "outputs":   [
        "{workspaceRoot}/dist/apps/website"
      ]
    },
    "deploy":                  {
      "dependsOn": [
        "angular-firebase-deploy"
      ],
      "executor":  "nx:noop"
    },
    "esbuild-intl-server":     {
      "dependsOn": [
        "angular-prerender"
      ],
      "executor":  "@nx/esbuild:esbuild",
      "options":   {
        "bundle":           true,
        "deleteOutputPath": false,
        "format":           [
          "cjs"
        ],
        "main":             "apps/website/src/app/main.intl-server.ts",
        "minify":           true,
        "outputPath":       "dist/apps/website/server",
        "thirdParty":       true,
        "tsConfig":         "apps/website/tsconfig.app.json"
      },
      "outputs":   [
        "{workspaceRoot}/{options.outputPath}"
      ]
    },
    "eslint":                  {
      "dependsOn": [
        "prebuild"
      ],
      "executor":  "@nx/linter:eslint",
      "options":   {
        "lintFilePatterns": [
          "apps/website/src/**/*.ts",
          "apps/website/src/**/*.html"
        ]
      }
    },
    "prebuild":                {
      "executor": "nx:run-commands",
      "options":  {
        "commands": [
          "rm -rf dist/apps/website",
          "node -p \"'import { GitInfo } from \\'git-describe\\';\\n\\n\\nexport const gitInfo: Partial<GitInfo> = ' + JSON.stringify(((gitInfo) => ({dirty: gitInfo.dirty,hash: gitInfo.hash}))(require('git-describe').gitDescribeSync())) + ';'\" > apps/website/src/.git-info.ts",
          "node -p \"'export const packageVersion: string = \\\"' + require('./package.json').version + '\\\" as const;'\" > apps/website/src/.package-version.ts"
        ]
      }
    }
  }
}
